!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/cdk/collections"),require("rxjs"),require("rxjs/operators"),require("@angular/common"),require("@angular/core"),require("ng-zorro-antd/icon"),require("ng-zorro-antd/spin"),require("d3-shape"),require("d3-drag"),require("d3-selection"),require("d3-zoom"),require("@angular/animations"),require("@nx-component/hierarchy-graph"),require("ng-zorro-antd/core/util")):"function"==typeof define&&define.amd?define("ng-zorro-antd/graph",["exports","@angular/cdk/collections","rxjs","rxjs/operators","@angular/common","@angular/core","ng-zorro-antd/icon","ng-zorro-antd/spin","d3-shape","d3-drag","d3-selection","d3-zoom","@angular/animations","@nx-component/hierarchy-graph","ng-zorro-antd/core/util"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self)["ng-zorro-antd"]=t["ng-zorro-antd"]||{},t["ng-zorro-antd"].graph={}),t.ng.cdk.collections,t.rxjs,t.rxjs.operators,t.ng.common,t.ng.core,t["ng-zorro-antd"].icon,t["ng-zorro-antd"].spin,t.d3Shape,t.d3Drag,t.d3Selection,t.d3Zoom,t.ng.animations,t.hierarchyGraph,t["ng-zorro-antd"].core.util)}(this,(function(t,e,n,i,o,r,a,s,h,d,p,c,l,u,g){"use strict";function m(){return function(t){return t}}var f={animation:{duration:250},graph:{meta:{nodeSep:50,rankSep:40,edgeSep:5},padding:{paddingTop:10,paddingLeft:0}},subscene:{meta:{paddingTop:20,paddingBottom:20,paddingLeft:20,paddingRight:20,labelHeight:20,extractXOffset:0,extractYOffset:0}},nodeSize:{meta:{radius:2,width:160,maxLabelWidth:0,height:100,expandButtonRadius:3},op:{width:160,height:100,radius:1,labelOffset:10,maxLabelWidth:40},bridge:{width:10,height:10,radius:2,labelOffset:0}},shortcutSize:{op:{width:10,height:4},meta:{width:12,height:4,radius:1},series:{width:14,height:4}},annotations:{inboxWidth:50,outboxWidth:50,xOffset:10,yOffset:3,labelOffset:2,maxLabelWidth:120},constant:{size:{width:4,height:4}},minimap:{size:150}};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function v(t,e,n,i){var o,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,n,a):o(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a}function y(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}Object.create;function z(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function x(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a}function w(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(x(arguments[e]));return t}Object.create;var b=function(){function t(t){var i;this._data=new n.BehaviorSubject({}),this.expansionModel=new e.SelectionModel(!0),t&&(null===(i=this.expansionModel)||void 0===i||i.clear(),this.dataSource=t,this._data.next(t))}return t.prototype.toggle=function(t){this.expansionModel.toggle(t)},t.prototype.expand=function(t){this.expansionModel.select(t)},t.prototype.collapse=function(t){this.expansionModel.deselect(t)},t.prototype.isExpanded=function(t){return this.expansionModel.isSelected(t)},t.prototype.collapseAll=function(){this.expansionModel.clear()},t.prototype.expandAll=function(){var t;(t=this.expansionModel).select.apply(t,w(Object.keys(this._data.value.compound||{})))},t.prototype.setData=function(t){var e;null===(e=this.expansionModel)||void 0===e||e.clear(),this.dataSource=t,this._data.next(t)},t.prototype.connect=function(){var t=this,e=[this._data,this.expansionModel.changed];return n.merge.apply(void 0,w(e)).pipe(i.map((function(){return t._data.value})))},t.prototype.disconnect=function(){},t}(),S=function(){};S.decorators=[{type:r.Directive,args:[{selector:"[nzGraphNode]",exportAs:"nzGraphNode"}]}];var C=function(){};C.decorators=[{type:r.Component,args:[{selector:"svg:defs[nz-graph-defs]",template:'\n    <svg:marker\n      class="nz-graph-edge-marker"\n      id="edge-end-arrow"\n      viewBox="1 0 20 20"\n      refX="9"\n      refY="3.5"\n      markerWidth="10"\n      markerHeight="10"\n      orient="auto"\n    >\n      <svg:polygon points="0 0, 10 3.5, 0 7"></svg:polygon>\n    </svg:marker>\n  '}]}],C.ctorParameters=function(){return[]};var E=function(){function t(t,e){this.elementRef=t,this.ngZone=e,this.line=h.line().x((function(t){return t.x})).y((function(t){return t.y})).curve(h.curveBasis),this.el=this.elementRef.nativeElement}return Object.defineProperty(t.prototype,"id",{get:function(){var t;return(null===(t=this.edge)||void 0===t?void 0:t.id)||this.edge.v+"--"+this.edge.w},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){this.setElementData()},t.prototype.setLine=function(){var t=this.getAdjoiningEdgeElement();if(t){var e=t.getPointAtLength(this.edge.inbound?t.getTotalLength():0).matrixTransform(t.getCTM()).matrixTransform(this.el.getCTM().inverse()),n=w(this.edge.points),i=this.edge.inbound?0:n.length-1;n[i].x=e.x,n[i].y=e.y,this.setPath(this.line(n))}else this.setPath(this.line(this.edge.points))},t.prototype.setPath=function(t){this.el.setAttribute("d",t)},t.prototype.setElementData=function(){this.el.setAttribute("data-edge",this.edge.v+"--"+this.edge.w),this.el.setAttribute("data-v",""+this.edge.v),this.el.setAttribute("data-w",""+this.edge.w)},t.prototype.getAdjoiningEdgeElement=function(){var t=this.edge.adjoiningEdge;return t?document.querySelector('path[data-edge="'+t.v+"--"+t.w+'"]'):null},t.prototype.ngOnChanges=function(t){var e=this;this.ngZone.onStable.pipe(i.take(1)).subscribe((function(){e.setLine()}))},t}();E.decorators=[{type:r.Directive,args:[{selector:"svg:path[nz-graph-edge]",host:{"[class.nz-graph-edge-line]":"true","[id]":"id"}}]}],E.ctorParameters=function(){return[{type:r.ElementRef},{type:r.NgZone}]},E.propDecorators={edge:[{type:r.Input}]};var O=function(){function t(t,e,n,i,o,r){var a=this;this.svg=t,this.labelPadding=r,this.zoomG=e,this.mainZoom=n,this.maxWandH=o;var s=p.select(i),h=s.select("svg"),c=h.select("rect");this.canvas=s.select("canvas.viewport").node(),this.canvasRect=this.canvas.getBoundingClientRect();var l=function(t){var e=a.minimapOffset(),n=Number(c.attr("width")),i=Number(c.attr("height")),o=p.pointer(t,h.node());a.viewpointCoord.x=o[0]-n/2-e.x,a.viewpointCoord.y=o[1]-i/2-e.y,a.updateViewpoint()};this.viewpointCoord={x:0,y:0};var u=d.drag().subject(Object).on("drag",l);c.datum(this.viewpointCoord).call(u),h.on("click",(function(t){t.defaultPrevented||l(t)})),this.viewpoint=c.node(),this.minimapSvg=h.node(),this.minimap=i,this.canvasBuffer=s.select("canvas.buffer").node(),this.update()}return t.prototype.minimapOffset=function(){return{x:(this.canvasRect.width-this.minimapSize.width)/2,y:(this.canvasRect.height-this.minimapSize.height)/2}},t.prototype.updateViewpoint=function(){p.select(this.viewpoint).attr("x",this.viewpointCoord.x).attr("y",this.viewpointCoord.y);var t=-this.viewpointCoord.x*this.scaleMain/this.scaleMinimap,e=-this.viewpointCoord.y*this.scaleMain/this.scaleMinimap;p.select(this.svg).call(this.mainZoom.transform,c.zoomIdentity.translate(t,e).scale(this.scaleMain))},t.prototype.update=function(){var t,e,n,i,o=this,r=null;try{if(0===(r=this.zoomG.getBBox()).width)return}catch(t){return}var a=p.select(this.svg),s="";try{for(var h=z(new Array(document.styleSheets.length).keys()),d=h.next();!d.done;d=h.next()){var c=d.value;try{var l=document.styleSheets[c].cssRules||document.styleSheets[c].rules;if(null==l)continue;try{for(var u=(n=void 0,z(new Array(l.length).keys())),g=u.next();!g.done;g=u.next()){s+=l[g.value].cssText.replace(/ ?tf-[\w-]+ ?/g,"")+"\n"}}catch(t){n={error:t}}finally{try{g&&!g.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}}catch(t){if("SecurityError"!==t.name)throw t}}}catch(e){t={error:e}}finally{try{d&&!d.done&&(e=h.return)&&e.call(h)}finally{if(t)throw t.error}}var m=a.append("style");m.text(s);var f=p.select(this.zoomG),v=f.attr("transform");f.attr("transform",null),r.height+=2*this.labelPadding,r.width+=2*this.labelPadding,a.attr("width",r.width).attr("height",r.height),this.scaleMinimap=this.maxWandH/Math.max(r.width,r.height),this.minimapSize={width:r.width*this.scaleMinimap,height:r.height*this.scaleMinimap};var y=this.minimapOffset();p.select(this.minimapSvg).attr(this.minimapSize),p.select(this.canvasBuffer).attr(this.minimapSize),null!=this.translate&&null!=this.zoom&&requestAnimationFrame((function(){return o.zoom()}));var w=(new XMLSerializer).serializeToString(this.svg);m.remove(),a.attr("width","100%").attr("height","100%"),f.attr("transform",v);var b=new Image;b.onload=function(){var t=o.canvasBuffer.getContext("2d");t.clearRect(0,0,o.canvasBuffer.width,o.canvasBuffer.height),t.drawImage(b,y.x,y.y,o.minimapSize.width,o.minimapSize.height),requestAnimationFrame((function(){var t;p.select(o.canvasBuffer).style("display","block"),p.select(o.canvas).style("display","none"),t=x([o.canvasBuffer,o.canvas],2),o.canvas=t[0],o.canvasBuffer=t[1]}))},b.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(w)},t.prototype.zoom=function(t){if(null!=this.scaleMinimap){t&&(this.translate=[t.x,t.y],this.scaleMain=t.k);var e=this.svg.getBoundingClientRect(),n=this.minimapOffset(),i=p.select(this.viewpoint);this.viewpointCoord.x=-this.translate[0]*this.scaleMinimap/this.scaleMain,this.viewpointCoord.y=-this.translate[1]*this.scaleMinimap/this.scaleMain;var o=e.width*this.scaleMinimap/this.scaleMain,r=e.height*this.scaleMinimap/this.scaleMain;i.attr("x",this.viewpointCoord.x+n.x).attr("y",this.viewpointCoord.y+n.y).attr("width",o).attr("height",r);var a=this.minimapSize.width,s=this.minimapSize.height,h=this.viewpointCoord.x,d=this.viewpointCoord.y;(Math.min(Math.max(0,h+o),a)-Math.min(Math.max(0,h),a))*(Math.min(Math.max(0,d+r),s)-Math.min(Math.max(0,d),s))/(a*s)<.8?this.minimap.classList.remove("hidden"):this.minimap.classList.add("hidden")}},t}(),I=function(){function t(t){this.elementRef=t}return t.prototype.ngOnInit=function(){},t.prototype.init=function(t,e,n){this.minimap=new O(t,e,n,this.elementRef.nativeElement,f.minimap.size,f.subscene.meta.labelHeight)},t.prototype.zoom=function(t){this.minimap&&this.minimap.zoom(t)},t.prototype.update=function(){this.minimap&&this.minimap.update()},t}();I.decorators=[{type:r.Component,args:[{selector:"nz-graph-minimap",template:'\n    <svg>\n      <defs>\n        <filter id="minimapDropShadow" x="-20%" y="-20%" width="150%" height="150%">\n          <feOffset result="offOut" in="SourceGraphic" dx="1" dy="1"></feOffset>\n          <feColorMatrix\n            result="matrixOut"\n            in="offOut"\n            type="matrix"\n            values="0.1 0 0 0 0 0 0.1 0 0 0 0 0 0.1 0 0 0 0 0 0.5 0"\n          ></feColorMatrix>\n          <feGaussianBlur result="blurOut" in="matrixOut" stdDeviation="2"></feGaussianBlur>\n          <feBlend in="SourceGraphic" in2="blurOut" mode="normal"></feBlend>\n        </filter>\n      </defs>\n      <rect></rect>\n    </svg>\n    <canvas class="viewport"></canvas>\n    \x3c!-- Additional canvas to use as buffer to avoid flickering between updates --\x3e\n    <canvas class="buffer"></canvas>\n  ',host:{"[class.nz-graph-minimap]":"true"}}]}],I.ctorParameters=function(){return[{type:r.ElementRef}]};var k=function(){function t(t,e,n){this.el=t,this.builder=e,this.renderer2=n,this.nodeClick=new r.EventEmitter,this.animationInfo=null,this.animationPlayer=null}return t.prototype.onTriggerClick=function(t){t.preventDefault(),this.nodeClick.emit(this.node)},t.prototype.makeAnimation=function(t){var e,i=this;void 0===t&&(t=!1),this.animationPlayer&&this.animationPlayer.destroy();var o=this.getAnimationInfo(),r=Object.assign({},this.animationInfo);e=t?this.builder.build([l.style({transform:"translate("+o.x+"px, "+o.y+"px)"}),l.query(".nz-graph-node-rect",[l.style({width:o.width+"px",height:o.height+"px"})])]):this.builder.build([l.style({transform:"translate("+r.x+"px, "+r.y+"px)"}),l.query(".nz-graph-node-rect",[l.style({width:r.width+"px",height:r.height+"px"})]),l.group([l.query(".nz-graph-node-rect",[l.animate("150ms ease-out",l.style({width:o.width+"px",height:o.height+"px"}))]),l.animate("150ms ease-out",l.style({transform:"translate("+o.x+"px, "+o.y+"px)"}))])]);var a=new n.Subject;return this.animationInfo=o,this.animationPlayer=e.create(this.el.nativeElement),this.animationPlayer.play(),this.animationPlayer.onDone((function(){i.renderer2.setAttribute(i.el.nativeElement,"transform","translate("+o.x+", "+o.y+")"),a.next(),a.complete()})),a.asObservable()},t.prototype.getAnimationInfo=function(){var t=this.nodeTransform(),e=t.x,n=t.y;return{width:this.node.width,height:this.node.height,x:e,y:n}},t.prototype.nodeTransform=function(){return{x:this.computeCXPositionOfNodeShape()-this.node.width/2,y:this.node.y-this.node.height/2}},t.prototype.computeCXPositionOfNodeShape=function(){return this.node.expanded?this.node.x:this.node.x-this.node.width/2+this.node.coreBox.width/2},t.prototype.ngAfterViewInit=function(){this.makeAnimation(!0)},t}();k.decorators=[{type:r.Directive,args:[{selector:"svg:g[nz-graph-node]",host:{"[id]":"node.id || node.name","[class.nz-graph-node-expanded]":"node.expanded","[class.nz-graph-group-node]":"node.type===0","[class.nz-graph-base-node]":"node.type===1","(click)":"onTriggerClick($event)"}}]}],k.ctorParameters=function(){return[{type:r.ElementRef},{type:l.AnimationBuilder},{type:r.Renderer2}]},k.propDecorators={node:[{type:r.Input}],nodeClick:[{type:r.Output}]};var M=function(){function t(t){this.cdr=t,this.maxZoomLevel=10,this.minZoomLevel=.1,this.zoom=1,this.zoomEvent=new r.EventEmitter,this.transformEvent=new r.EventEmitter,this.transform={x:0,y:0,k:1},this.transformStyle=""}return t.prototype.ngOnInit=function(){this.bind()},t.prototype.ngOnDestroy=function(){this.unbind()},t.prototype.bind=function(){var t=this;this.svgSelect=p.select(this.containerElement.nativeElement),this.zoomController=c.zoom().scaleExtent([this.minZoomLevel,this.maxZoomLevel]).on("zoom",(function(e){var n=e.transform,i=n.x,o=n.y,r=n.k;t.zoom=r,t.zoomEvent.emit(r),t.transform=n,t.transformEvent.emit(n),t.transformStyle="translate("+i+" ,"+o+")scale("+r+")",t.cdr.detectChanges()})),this.svgSelect.call(this.zoomController,c.zoomIdentity.translate(0,0).scale(this.zoom))},t.prototype.unbind=function(){var t;null===(t=this.svgSelect)||void 0===t||t.interrupt().selectAll("*").interrupt(),this.zoomController&&(this.zoomController.on("end",null).on("zoom",null),this.transformEvent.complete())},t.prototype.fit=function(t,e){var n=this;void 0===t&&(t=500),void 0===e&&(e=.9);var i=this.containerElement.nativeElement.getBoundingClientRect(),o=null;try{if(0===(o=this.zoomElement.nativeElement.getBBox()).width)return}catch(t){return}var r=Math.min(i.width/o.width,i.height/o.height,2)*e,a=(i.width-o.width*r)/2,s=(i.height-o.height*r)/2,h=f.graph,d=c.zoomIdentity.translate(a+h.padding.paddingLeft,s+h.padding.paddingTop).scale(r);this.svgSelect.transition().duration(t).call(this.zoomController.transform,d).on("end.fitted",(function(){n.zoomController.on("end.fitted",null)}))},t.prototype.setNodeToCenter=function(t){if(t&&this.containerElement.nativeElement.contains(t)){var e=this.containerElement.nativeElement.getBoundingClientRect(),n=this.getRelativePositionInfo(t),i=c.zoomTransform(this.containerElement.nativeElement),o=(n.topLeft.x+n.bottomRight.x)/2,r=(n.topLeft.y+n.bottomRight.y)/2,a=e.left+e.width/2-o,s=e.top+e.height/2-r;p.select(this.containerElement.nativeElement).transition().duration(250).call(this.zoomController.translateBy,a/i.k,s/i.k)}},t.prototype.getRelativePositionInfo=function(t){var e=t.getBBox(),n=t.getScreenCTM(),i=this.containerElement.nativeElement.createSVGPoint(),o=this.containerElement.nativeElement.createSVGPoint();return i.x=e.x,i.y=e.y,o.x=e.x+e.width,o.y=e.y+e.height,{topLeft:i=i.matrixTransform(n),bottomRight:o=o.matrixTransform(n)}},t}();function T(t){return t&&"function"==typeof t.connect}M.decorators=[{type:r.Component,args:[{changeDetection:r.ChangeDetectionStrategy.OnPush,encapsulation:r.ViewEncapsulation.None,selector:"nz-graph-svg-container",exportAs:"nzGraphSvgContainer",template:'\n    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" #container width="100%" height="100%">\n      <rect width="100%" height="100%" fill="transparent" class="nz-graph-background"></rect>\n      <g #zoom [attr.transform]="transformStyle" class="nz-graph-zoom">\n        <ng-content></ng-content>\n      </g>\n    </svg>\n  ',host:{"[class.nz-graph-svg-container]":"true"}}]}],M.ctorParameters=function(){return[{type:r.ChangeDetectorRef}]},M.propDecorators={containerElement:[{type:r.ViewChild,args:["container",{static:!0}]}],zoomElement:[{type:r.ViewChild,args:["zoom",{static:!0}]}],maxZoomLevel:[{type:r.Input}],minZoomLevel:[{type:r.Input}],zoom:[{type:r.Input}],zoomEvent:[{type:r.Output}],transformEvent:[{type:r.Output}]};var R=function(){function t(t,e,i){this.cdr=t,this.ngZone=e,this.elementRef=i,this.nzRankDirection="LR",this.nzShowMinimap=!1,this.nzShowArrow=!1,this.nzZoom=1,this.nzAutoSize=!1,this.nzGraphInitialized=new r.EventEmitter,this.nzZoomInit=new r.EventEmitter,this.nzTransformEvent=new r.EventEmitter,this.nzNodeClick=new r.EventEmitter,this.renderInfo={labelHeight:0},this.mapOfNodeAttr={},this.mapOfEdgeAttr={},this.typedNodes=function(t){return t},this.layoutSetting=f,this.destroy$=new n.Subject,this.nodeTrackByFun=function(t,e){return e.name},this.edgeTrackByFun=function(t,e){return e.v+"-"+e.w},this.subGraphTransform=function(t){return"translate("+(t.x-t.coreBox.width/2)+", "+(t.y-t.height/2+t.paddingTop/2)+")"},this.coreTransform=function(t){return"translate(0, "+t.labelHeight+")"}}return t.prototype.ngOnInit=function(){this.dataSource!==this.nzGraphData&&this._switchDataSource(this.nzGraphData)},t.prototype.ngOnChanges=function(t){var e=t.nzAutoFit,n=t.nzRankDirection,i=t.nzGraphData;t.nzGraphLayoutSettings&&Object.assign(this.layoutSetting,this.nzGraphLayoutSettings||{}),i&&this.dataSource!==this.nzGraphData&&this._switchDataSource(this.nzGraphData),(e&&!e.firstChange||n&&!n.firstChange)&&this.dataSource.dataSource&&this.renderGraph(this.dataSource.dataSource,{rankDirection:this.nzRankDirection,expanded:this.dataSource.expansionModel.selected||[]}),this.cdr.markForCheck()},t.prototype.ngAfterViewInit=function(){this.autoFit(),this.drawMinimap(!0)},t.prototype.ngAfterContentChecked=function(){this.dataSource&&!this._dataSubscription&&this.observeRenderChanges()},t.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete(),this.dataSource&&"function"==typeof this.dataSource.disconnect&&this.dataSource.disconnect(),this._dataSubscription&&(this._dataSubscription.unsubscribe(),this._dataSubscription=null)},t.prototype.triggerTransform=function(t){this.nzZoom=t.k,this.minimap&&this.minimap.zoom(t),this.nzTransformEvent.emit(t),this.cdr.markForCheck()},t.prototype.clickNode=function(t){this.nzNodeClick.emit(t)},t.prototype.autoFit=function(){var t;this.renderInfo&&(null===(t=this.svgContainerComponent)||void 0===t||t.fit(0))},t.prototype.toggleNode=function(t,e){e?this.nzGraphData.collapse(t):this.nzGraphData.expand(t)},t.prototype.renderGraph=function(t,e){var n=this.buildGraphInfo(t,e);this.setRenderInfo(n,!1),this.nzAutoSize&&this.resizeNodes(n,e),this.cdr.detectChanges()},t.prototype._switchDataSource=function(t){this.dataSource&&"function"==typeof this.dataSource.disconnect&&this.nzGraphData.disconnect(),this._dataSubscription&&(this._dataSubscription.unsubscribe(),this._dataSubscription=null),this.dataSource=t,this.observeRenderChanges()},t.prototype.observeRenderChanges=function(){var t,e=this,n={rankDirection:this.nzRankDirection};if(T(this.dataSource)&&(t=this.dataSource.connect()),!t)throw Error("A valid data source must be provided.");this._dataSubscription=t.pipe(i.takeUntil(this.destroy$)).subscribe((function(t){n={rankDirection:e.nzRankDirection,expanded:e.nzGraphData.expansionModel.selected},e.renderGraph(t,n),e.cdr.detectChanges()}))},t.prototype.setRenderInfo=function(t,e){var n=this;void 0===e&&(e=!0),e?this.assignRenderInfo(t):this.renderInfo=t,this.ngZone.onStable.pipe(i.take(1)).subscribe((function(){n.makeNodesAnimation().subscribe()}))},t.prototype.buildGraphInfo=function(t,e){var n=this;this.parseInfo(t);var i=u.buildGraph(t,e,this.layoutSetting),o=function(t){t.forEach((function(t){1===t.type&&n.mapOfNodeAttr.hasOwnProperty(t.name)?Object.assign(t,n.mapOfNodeAttr[t.name]):0===t.type&&(t.edges.forEach((function(t){n.mapOfEdgeAttr.hasOwnProperty(t.v+"-"+t.w)&&Object.assign(t,n.mapOfEdgeAttr[t.v+"-"+t.w])})),o(t.nodes))}))};return o(i.nodes),i.edges.forEach((function(t){n.mapOfEdgeAttr.hasOwnProperty(t.v+"-"+t.w)&&Object.assign(t,n.mapOfEdgeAttr[t.v+"-"+t.w])})),i},t.prototype.resizeNodes=function(t,e){var n=this;this.ngZone.onStable.asObservable().pipe(i.take(1),i.finalize((function(){n.cdr.detectChanges()}))).subscribe((function(){var i=n.dataSource.dataSource;n.elementRef.nativeElement.querySelectorAll("[nz-graph-node]").forEach((function(e){var o=e.querySelector(".nz-graph-node-wrapper");if(o){var r=o.getBoundingClientRect().height,a=o.getBoundingClientRect().width,s=function(t){var e=[],n=[],i=function(t){e.push(t),0===t.type&&(n=n.concat(t.edges),t.nodes.forEach((function(t){return i(t)})))};return i(t),w(e)}(t).find((function(t){return""+t.name===e.id})),h=s&&s.name,d=i.nodes.find((function(t){return t.id===h}));d&&(d.height=r/n.nzZoom,d.width=a/n.nzZoom)}}));var o=n.buildGraphInfo(i,e);n.setRenderInfo(o,!1)}))},t.prototype.assignRenderInfo=function(t){this.renderInfo.edges=t.edges,this.renderInfo.nodes.forEach((function(e,n){Object.assign(e,t.nodes[n])}))},t.prototype.makeNodesAnimation=function(){var t=this;return n.forkJoin.apply(void 0,w(this.graphNodes.map((function(t){return t.makeAnimation()})))).pipe(i.tap((function(){t.drawMinimap()})),i.finalize((function(){t.cdr.detectChanges()})))},t.prototype.parseInfo=function(t){var e=this;t.nodes.forEach((function(t){e.mapOfNodeAttr[t.id]=t})),t.edges.forEach((function(t){e.mapOfEdgeAttr[t.v+"-"+t.w]=t}))},t.prototype.drawMinimap=function(t){var e,n;void 0===t&&(t=!1),this.minimap&&this.nzShowMinimap&&(t?null===(e=this.minimap)||void 0===e||e.init(this.svgContainerComponent.containerElement.nativeElement,this.svgContainerComponent.zoomElement.nativeElement,this.svgContainerComponent.zoomController):null===(n=this.minimap)||void 0===n||n.update())},t}();R.decorators=[{type:r.Component,args:[{changeDetection:r.ChangeDetectionStrategy.OnPush,encapsulation:r.ViewEncapsulation.None,selector:"nz-graph",exportAs:"nzGraph",template:'\n    <ng-content></ng-content>\n    <nz-graph-svg-container (transformEvent)="triggerTransform($event)">\n      <svg:defs nz-graph-defs></svg:defs>\n      <ng-container [ngTemplateOutlet]="groupTemplate" [ngTemplateOutletContext]="{ renderInfo: renderInfo, type: \'root\' }"></ng-container>\n    </nz-graph-svg-container>\n\n    <nz-graph-minimap *ngIf="nzShowMinimap"></nz-graph-minimap>\n\n    <ng-template #groupTemplate let-renderInfo="renderInfo" let-type="type">\n      <svg:g [attr.transform]="type === \'sub\' ? subGraphTransform(renderInfo) : null">\n        <svg:g class="core" [attr.transform]="coreTransform(renderInfo)">\n          <svg:g class="nz-graph-edges">\n            <svg:g class="nz-graph-edge" *ngFor="let edge of renderInfo.edges; let index = index; trackBy: edgeTrackByFun">\n              <svg:path\n                class="nz-graph-edge-line"\n                nz-graph-edge\n                [attr.marker-end]="nzShowArrow ? \'url(#edge-end-arrow)\' : null"\n                [edge]="edge"\n              ></svg:path>\n              <svg:text class="nz-graph-edge-text" text-anchor="middle" dy="20" *ngIf="edge.label">\n                <textPath [attr.href]="\'#\' + edge.v + \'--\' + edge.w" startOffset="50%">{{ edge.label }}</textPath>\n              </svg:text>\n            </svg:g>\n          </svg:g>\n\n          <svg:g class="nz-graph-nodes">\n            <svg:g\n              class="nz-graph-node"\n              [class.nz-graph-custom-node]="!!customGraphNodeTemplate"\n              [style.display]="node.type === 2 ? \'none\' : null"\n              *ngFor="let node of typedNodes(renderInfo.nodes); trackBy: nodeTrackByFun"\n            >\n              <svg:g nz-graph-node [node]="node" (nodeClick)="clickNode($event)">\n                <foreignObject class="nz-graph-node-rect" x="0" y="0" [attr.width]="node.width" [attr.height]="node.height">\n                  <xhtml:div class="nz-graph-node-wrapper">\n                    <ng-container\n                      *ngIf="customGraphNodeTemplate"\n                      [ngTemplateOutlet]="customGraphNodeTemplate"\n                      [ngTemplateOutletContext]="{ $implicit: node }"\n                    ></ng-container>\n                    <div class="node-content" *ngIf="!customGraphNodeTemplate">\n                      <div class="title">\n                        {{ node.name }}\n                        <i\n                          class="action-icon"\n                          *ngIf="node.type === 0"\n                          nz-icon\n                          [nzType]="node.expanded ? \'minus\' : \'plus\'"\n                          nzTheme="outline"\n                          (click)="toggleNode(node.name, node.expanded)"\n                        ></i>\n                      </div>\n                      <div class="label" *ngIf="!node.expanded">{{ node.label }}</div>\n                    </div>\n                  </xhtml:div>\n                </foreignObject>\n              </svg:g>\n\n              <ng-container\n                *ngIf="node.expanded"\n                [ngTemplateOutlet]="groupTemplate"\n                [ngTemplateOutletContext]="{ renderInfo: node, type: \'sub\' }"\n              ></ng-container>\n            </svg:g>\n          </svg:g>\n        </svg:g>\n      </svg:g>\n    </ng-template>\n  ',host:{"[class.nz-graph]":"true","[class.nz-graph-auto-fit]":"nzAutoSize"}}]}],R.ctorParameters=function(){return[{type:r.ChangeDetectorRef},{type:r.NgZone},{type:r.ElementRef}]},R.propDecorators={graphNodes:[{type:r.ViewChildren,args:[k]}],svgContainerComponent:[{type:r.ViewChild,args:[M]}],minimap:[{type:r.ViewChild,args:[I]}],customGraphNodeTemplate:[{type:r.ContentChild,args:[S,{static:!0,read:r.TemplateRef}]}],nzGraphData:[{type:r.Input}],nzRankDirection:[{type:r.Input}],nzGraphLayoutSettings:[{type:r.Input}],nzShowMinimap:[{type:r.Input}],nzShowArrow:[{type:r.Input}],nzZoom:[{type:r.Input}],nzAutoSize:[{type:r.Input}],nzGraphInitialized:[{type:r.Output}],nzZoomInit:[{type:r.Output}],nzTransformEvent:[{type:r.Output}],nzNodeClick:[{type:r.Output}]},v([g.InputBoolean(),y("design:type",Object)],R.prototype,"nzShowMinimap",void 0),v([g.InputBoolean(),y("design:type",Object)],R.prototype,"nzShowArrow",void 0),v([g.InputBoolean(),y("design:type",Object)],R.prototype,"nzAutoSize",void 0);var A=[R,M,E,k,I,C,S],D=function(){};D.decorators=[{type:r.NgModule,args:[{declarations:w(A),imports:[o.CommonModule,a.NzIconModule,s.NzSpinModule],exports:w(A)}]}],t.NZ_GRAPH_LAYOUT_SETTING=f,t.NzCustomGraphNodeDirective=S,t.NzGraphComponent=R,t.NzGraphData=b,t.NzGraphEdgeDirective=E,t.NzGraphModule=D,t.NzGraphNodeDirective=k,t.NzGraphSvgContainerComponent=M,t.isDataSource=T,t.nzTypeDefinition=m,t.ɵa=I,t.ɵb=C,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-zorro-antd-graph.umd.min.js.map